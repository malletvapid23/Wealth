<div *ngIf="resourcePool !== null">
    <h2>{{ resourcePool.Name }}</h2>
    <hr />

    <button type="button" (click)="toggleResourcePool()" class="btn-link">Resource Pool</button>
    <button type="button" (click)="toggleElements()" class="btn-link">Elements</button>
    <button type="button" (click)="toggleFields()" class="btn-link" *ngIf="resourcePool.ElementSet.length > 0">Fields</button>
    <button type="button" (click)="toggleItems()" class="btn-link" *ngIf="resourcePool.ElementSet.length > 0">Items</button>
    <button type="button" (click)="toggleCells()" class="btn-link" *ngIf="resourcePool.ElementSet.length > 0">Cells</button>

    <button type="button" class="btn btn-link pull-right" (click)="viewResourcePool()">
        <i class="fa fa-home" aria-hidden="true"></i> View
    </button>
    <hr />

    <div [hidden]="!displayResourcePool">
        <form #resourcePoolForm="ngForm">
            <div class="form-horizontal g-mt-40">
                <div class="form-group" [ngClass]="{ 'has-error': resourcePool.entityAspect.getValidationErrors('Name').length > 0 }">
                    <label for="Name" class="control-label col-md-2">Name</label>
                    <div class="col-md-10">
                        <input id="Name" name="Name" type="text" [(ngModel)]="resourcePool.Name" class="form-control" />
                    </div>
                </div>
                <div class="form-group" [ngClass]="{ 'has-error': resourcePool.entityAspect.getValidationErrors('Key').length > 0 }">
                    <label for="Key" class="control-label col-md-2">Key</label>
                    <div class="col-md-10">
                        <input id="Key" name="Key" type="text" [(ngModel)]="resourcePool.Key" class="form-control" aria-describedby="KeyHelp" />
                        <span id="KeyHelp" class="help-block">
                            Title that will be used in the url.<br />
                            No special characters allowed, except dash "-" and underscore "_".
                        </span>
                    </div>
                </div>
                <div class="form-group" [ngClass]="{ 'has-error': resourcePool.entityAspect.getValidationErrors('Description').length > 0 }">
                    <label for="Description" class="control-label col-md-2">Description</label>
                    <div class="col-md-10">
                        <textarea id="Description" name="Description" [(ngModel)]="resourcePool.Description" class="form-control" rows="3"></textarea>
                    </div>
                </div>
                <div class="form-group" [ngClass]="{ 'has-error': resourcePool.entityAspect.getValidationErrors('InitialValue').length > 0 }">
                    <label for="InitialValue" class="control-label col-md-2">Initial Amount</label>
                    <div class="col-md-10">
                        <input id="InitialValue" name="InitialValue" type="text" [(ngModel)]="resourcePool.InitialValue" class="form-control" aria-describedby="InitialValueHelp" />
                        <span id="InitialValueHelp" class="help-block">Initial amount in the pool.</span>
                    </div>
                </div>
                <div class="form-group hide">
                    <div class="col-md-10">
                        <input id="RowVersion" name="RowVersion" [(ngModel)]="resourcePool.RowVersion" type="hidden">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-offset-2 col-md-10">
                        <button (click)="saveResourcePool()" [disabled]="submitDisabled('resourcePool')" type="button" class="btn btn-primary">
                            Save CMRP
                        </button>
                        <button (click)="cancelResourcePool()" [disabled]="isBusy" type="button" class="btn btn-default">
                            {{ resourcePool.entityAspect.entityState.isModified() ? "Cancel" : "Close" }}
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div [hidden]="!displayElements">

        <!-- Element add/edit -->
        <div *ngIf="selectedElement">
            <element-manager [element]="selectedElement" (cancelled)="onElementManagerClosed()" (saved)="onElementManagerClosed()"></element-manager>
        </div>

        <!-- Element list -->
        <div *ngIf="!selectedElement">
            <p class="g-mt-10">
                <button (click)="addElement()" type="button" class="btn btn-link">
                    <i class="fa fa-plus" aria-hidden="true"></i> Create New
                </button>
            </p>
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>
                            Name
                        </th>
                        <th>
                            Is Main Element
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let element of resourcePool.ElementSet">
                        <td>
                            {{ element.Name }}
                        </td>
                        <td>
                            {{ element.IsMainElement }}
                        </td>
                        <td>
                            <button (click)="editElement(element)" type="button" class="btn btn-link">
                                <i class="fa fa-pencil" aria-hidden="true"></i> Edit
                            </button>
                            <button (click)="setMainElement(element)" [hidden]="element.IsMainElement" [disabled]="isBusy" type="button" class="btn btn-link" title="Determines whether CMRP Editor will start with this item or not.
                                    Only one element can be 'Main Element' and it cannot be deleted.">
                                <i class="fa fa-check" aria-hidden="true"></i> Set as main element
                            </button>
                            <button (click)="removeElement(element)" *ngIf="!element.IsMainElement" [disabled]="isBusy" type="button" class="btn btn-link">
                                <i class="fa fa-times" aria-hidden="true"></i> Remove
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div [hidden]="!displayFields">

        <!-- Element field add/edit -->
        <div *ngIf="isElementFieldEdit">
            <form #elementFieldForm="ngForm">
                <div class="form-horizontal g-mt-40">
                    <div class="form-group" *ngIf="elementField.entityAspect.entityState.isAdded()" [ngClass]="{ 'has-error': elementField.entityAspect.getValidationErrors('Element').length > 0 }">
                        <label for="ElementId" class="control-label col-md-2">Element</label>
                        <div class="col-md-10">
                            <select id="ElementId" name="ElementId" [(ngModel)]="elementField.Element" class="form-control">
                                <option *ngFor="let element of resourcePool.ElementSet" [ngValue]="element">{{ element.Name }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" *ngIf="!elementField.entityAspect.entityState.isAdded()">
                        <label for="ElementId" class="control-label col-md-2">Element</label>
                        <p class="form-control-static col-md-10">{{ elementField.Element.Name }}</p>
                    </div>
                    <div class="form-group" [ngClass]="{ 'has-error': elementField.entityAspect.getValidationErrors('Name').length > 0 }">
                        <label for="Name" class="control-label col-md-2">Name</label>
                        <div class="col-md-10">
                            <input id="Name" name="Name" type="text" [(ngModel)]="elementField.Name" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group" [ngClass]="{ 'has-error': elementField.entityAspect.getValidationErrors('DataType').length > 0 }">
                        <label for="DataType" class="control-label col-md-2">Data Type</label>
                        <div class="col-md-10">
                            <select id="DataType" name="DataType" [(ngModel)]="elementField.DataType" class="form-control">
                                <option *ngFor="let item of getElementFieldDataTypeFiltered()" [value]="item.value">{{ item.name }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" *ngIf="elementField.DataType === ElementFieldDataType.Element" [ngClass]="{ 'has-error': elementField.entityAspect.getValidationErrors('SelectedElement').length > 0 }">
                        <label for="SelectedElementId" class="control-label col-md-2">Selected Element</label>
                        <div class="col-md-10">
                            <select id="SelectedElementId" name="SelectedElementId" [(ngModel)]="elementField.SelectedElement" class="form-control">
                                <option *ngFor="let element of resourcePool.ElementSet" [ngValue]="element">{{ element.Name }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" *ngIf="elementField.DataType === ElementFieldDataType.Decimal" [ngClass]="{ 'has-error': elementField.entityAspect.getValidationErrors('UseFixedValue').length > 0 }">
                        <label class="control-label col-md-2">Use Fixed Value</label>
                        <div class="col-md-10">
                            <select id="UseFixedValue" name="UseFixedValue" [(ngModel)]="elementField.UseFixedValue" class="form-control" aria-describedby="UseFixedValueHelp">
                                <option value="true">True</option>
                                <option value="false" selected="selected">False</option>
                            </select>
                            <span id="UseFixedValueHelp" class="help-block">
                                Determines whether the values of this field will contain static data or will be set by users.<br />
                                e.g. 'Product Price' field should use a fixed value and 'Rating' field should be set by all users.
                            </span>
                        </div>
                    </div>
                    <div class="form-group" *ngIf="elementField.DataType !== ElementFieldDataType.String && elementField.DataType !== ElementFieldDataType.Element" [ngClass]="{ 'has-error': elementField.entityAspect.getValidationErrors('IndexEnabled').length > 0 }">
                        <label for="IndexEnabled" class="control-label col-md-2">Index Enabled</label>
                        <div class="col-md-10">
                            <select id="IndexEnabled" name="IndexEnabled" [(ngModel)]="elementField.IndexEnabled" class="form-control" aria-describedby="IndexEnabledHelp">
                                <option value="true">True</option>
                                <option value="false" selected="selected">False</option>
                            </select>
                            <span id="IndexEnabledHelp" class="help-block">
                                Determines whether the values of this field will be used for calculating an income from the pool.
                                e.g. Should be 'true' for 'Rating' field.
                            </span>
                        </div>
                    </div>
                    <div class="form-group" [ngClass]="{ 'has-error': elementField.entityAspect.getValidationErrors('SortOrder').length > 0 }">
                        <label for="SortOrder" class="control-label col-md-2">Sort Order</label>
                        <div class="col-md-10">
                            <input id="SortOrder" name="SortOrder" type="text" [(ngModel)]="elementField.SortOrder" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group" *ngIf="elementField.IndexEnabled" [ngClass]="{ 'has-error': elementField.UserElementFieldSet[0].entityAspect.getValidationErrors('Rating').length > 0 }">
                        <label for="Rating" class="control-label col-md-2">Rating</label>
                        <div class="col-md-10">
                            <input id="Rating" name="Rating" type="text" [(ngModel)]="elementField.UserElementFieldSet[0].Rating" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group hide">
                        <div class="col-md-10">
                            <input id="RowVersion" name="RowVersion" [(ngModel)]="elementField.RowVersion" type="hidden">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-10">
                            <button (click)="saveElementField()" [disabled]="submitDisabled('elementField')" type="button" class="btn btn-primary">
                                Save Field
                            </button>
                            <button (click)="cancelElementField()" [disabled]="isBusy" type="button" class="btn btn-default">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Element field list -->
        <div *ngIf="!isElementFieldEdit">
            <p class="g-mt-10">
                <button (click)="addElementField()" type="button" class="btn btn-link">
                    <i class="fa fa-plus" aria-hidden="true"></i> Create New
                </button>
            </p>
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>
                            Element
                        </th>
                        <th>
                            Name
                        </th>
                        <th>
                            Field Type
                        </th>
                        <th>
                            Index Enabled
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let elementField of elementFieldSet()">
                        <td>
                            {{ elementField.Element.Name }}
                        </td>
                        <td>
                            {{ elementField.Name }}
                        </td>
                        <td>
                            {{ elementField.DataTypeText }}
                        </td>
                        <td>
                            {{ elementField.IndexEnabled }}
                        </td>
                        <td>
                            <button (click)="editElementField(elementField)" type="button" class="btn btn-link">
                                <i class="fa fa-pencil" aria-hidden="true"></i> Edit
                            </button>
                            <button (click)="removeElementField(elementField)" [disabled]="isBusy" type="button" class="btn btn-link">
                                <i class="fa fa-times" aria-hidden="true"></i> Remove
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div [hidden]="!displayItems">

        <!-- Element item add/edit -->
        <div *ngIf="isElementItemEdit">
            <form #elementItemForm="ngForm">
                <div class="form-horizontal g-mt-40">
                    <div class="form-group" *ngIf="elementItem.entityAspect.entityState.isAdded()" [ngClass]="{ 'has-error': elementItem.entityAspect.getValidationErrors('Element').length > 0 }">
                        <label for="ElementId" class="control-label col-md-2">Element</label>
                        <div class="col-md-10">
                            <select id="ElementId" name="ElementId" [(ngModel)]="elementItem.Element" class="form-control">
                                <option *ngFor="let element of resourcePool.ElementSet" [ngValue]="element">{{ element.Name }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" *ngIf="!elementItem.entityAspect.entityState.isAdded()">
                        <label for="ElementId" class="control-label col-md-2">Element</label>
                        <p class="form-control-static col-md-10">{{ elementItem.Element.Name }}</p>
                    </div>
                    <div class="form-group" [ngClass]="{ 'has-error': elementItem.entityAspect.getValidationErrors('Name').length > 0 }">
                        <label for="Name" class="control-label col-md-2">Name</label>
                        <div class="col-md-10">
                            <input id="Name" name="Name" type="text" [(ngModel)]="elementItem.Name" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group hide">
                        <div class="col-md-10">
                            <input id="RowVersion" name="RowVersion" [(ngModel)]="elementItem.RowVersion" type="hidden">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-10">
                            <button (click)="saveElementItem()" [disabled]="submitDisabled('elementItem')" type="button" class="btn btn-primary">
                                Save Item
                            </button>
                            <button (click)="cancelElementItem()" [disabled]="isBusy" class="btn btn-default" type="button">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Element item list -->
        <div *ngIf="!isElementItemEdit">
            <p class="g-mt-10">
                <button (click)="addElementItem()" type="button" class="btn btn-link">
                    <i class="fa fa-plus" aria-hidden="true"></i> Create New
                </button>
            </p>
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>
                            Element
                        </th>
                        <th>
                            Name
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let elementItem of elementItemSet()">
                        <td>
                            {{ elementItem.Element.Name }}
                        </td>
                        <td>
                            {{ elementItem.Name }}
                        </td>
                        <td>
                            <button (click)="editElementItem(elementItem)" type="button" class="btn btn-link">
                                <i class="fa fa-pencil" aria-hidden="true"></i> Edit
                            </button>
                            <button (click)="removeElementItem(elementItem)" [disabled]="isBusy" type="button" class="btn btn-link">
                                <i class="fa fa-times" aria-hidden="true"></i> Remove
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Element cell add/edit -->
    <div [hidden]="!displayCells">
        <div *ngIf="isElementCellEdit">
            <form #elementCellForm="ngForm">
                <div class="form-horizontal g-mt-40">
                    <div class="form-group">
                        <label class="control-label col-md-2">Element</label>
                        <p class="form-control-static col-md-10">{{ elementCell.ElementField.Element.Name }}</p>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">Element Field</label>
                        <p class="form-control-static col-md-10">{{ elementCell.ElementField.Name }}</p>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">Element Item</label>
                        <p class="form-control-static col-md-10">{{ elementCell.ElementItem.Name }}</p>
                    </div>
                    <div class="form-group" *ngIf="elementCell.ElementField.DataType === ElementFieldDataType.String" [ngClass]="{ 'has-error': elementCell.entityAspect.getValidationErrors('StringValue').length > 0 }">
                        <label for="StringValue" class="control-label col-md-2">Value</label>
                        <div class="col-md-10">
                            <input id="StringValue" name="StringValue" type="text" [(ngModel)]="elementCell.StringValue" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group" *ngIf="elementCell.ElementField.DataType === ElementFieldDataType.Decimal" [ngClass]="{ 'has-error': elementCell.UserElementCellSet[0].entityAspect.getValidationErrors('DecimalValue').length > 0 }">
                        <label for="DecimalValue" class="control-label col-md-2">Value</label>
                        <div class="col-md-10">
                            <input id="DecimalValue" name="DecimalValue" type="text" [(ngModel)]="elementCell.UserElementCellSet[0].DecimalValue" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group" *ngIf="elementCell.ElementField.DataType === ElementFieldDataType.Element" [ngClass]="{ 'has-error': elementCell.entityAspect.getValidationErrors('SelectedItem').length > 0 }">
                        <label for="SelectedElementItemId" class="control-label col-md-2">Selected Item</label>
                        <div class="col-md-10">
                            <select id="SelectedElementItemId" name="SelectedElementItemId" [(ngModel)]="elementCell.SelectedElementItem" class="form-control">
                                <option *ngFor="let elementItem of elementCell.ElementField.SelectedElement.ElementItemSet" [ngValue]="elementItem">{{ elementItem.Name }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group hide">
                        <div class="col-md-10">
                            <input id="RowVersion" name="RowVersion" [(ngModel)]="elementCell.RowVersion" type="hidden">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-10">
                            <button (click)="saveElementCell()" [disabled]="submitDisabled('elementCell')" type="button" class="btn btn-primary">
                                Save Cell
                            </button>
                            <button (click)="cancelElementCell()" [disabled]="isBusy" type="button" class="btn btn-default">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Element cell list -->
        <div *ngIf="!isElementCellEdit">
            <p class="g-mt-10">
                <button class="btn btn-link invisible" type="button">
                    &nbsp; <!--Just to align with other tabs-->
                </button>
            </p>
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>
                            Element
                        </th>
                        <th>
                            Element Field
                        </th>
                        <th>
                            Element Item
                        </th>
                        <th>
                            Value
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let elementCell of elementCellSet()">
                        <td>
                            {{ elementCell.ElementField.Element.Name }}
                        </td>
                        <td>
                            {{ elementCell.ElementField.Name }}
                        </td>
                        <td>
                            {{ elementCell.ElementItem.Name }}
                        </td>
                        <td>
                            <span *ngIf="elementCell.ElementField.DataType === ElementFieldDataType.String">
                                {{ elementCell.StringValue }}
                            </span>
                            <span *ngIf="elementCell.ElementField.DataType === ElementFieldDataType.Decimal">
                                {{ elementCell.UserElementCellSet[0] ? elementCell.UserElementCellSet[0].DecimalValue : "N/A" }}
                            </span>
                            <span *ngIf="elementCell.ElementField.DataType === ElementFieldDataType.Element">
                                {{ elementCell.SelectedElementItem ? elementCell.SelectedElementItem.Name : "N/A" }}
                            </span>
                        </td>
                        <td>
                            <button (click)="editElementCell(elementCell)" type="button" class="btn btn-link">
                                <i class="fa fa-pencil" aria-hidden="true"></i> Edit
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
