/***
 * Service: entityManagerFactory 
 *
 * Configures BreezeJS and creates new instance(s) of the 
 * BreezeJS EntityManager for use in a 'dataContext' service
 *
 ***/
(function () {
    'use strict';

    var serviceId = 'entityManagerFactory';
    angular.module('main')
        .factory(serviceId, ['breeze', entityManagerFactory]);

    function entityManagerFactory(breeze) {
        configureBreeze();
        var serviceRoot = window.location.protocol + '//' + window.location.host + '/';
        var serviceName = serviceRoot + 'odata/';
        var factory = {
            newManager: newManager,
            serviceName: serviceName
        };

        return factory;

        function configureBreeze() {
            // use Web API OData to query and save
            breeze.config.initializeAdapterInstance('dataService', 'webApiOData', true);

            // convert between server-side PascalCase and client-side camelCase
            // breeze.NamingConvention.camelCase.setAsDefault();
        }

        function newManager() {
            var mgr = new breeze.EntityManager(serviceName);

            // TODO async?!
            mgr.fetchMetadata();

            //var metadata = {
            //    "metadataVersion": "1.0.5", "namingConvention": "noChange", "localQueryComparisonOptions": "caseInsensitiveSQL", "dataServices": [{
            //        "serviceName": "http://localhost:10001/odata/",
            //        "hasServerMetadata": true, "jsonResultsAdapter": "OData_default", "useJsonp": false
            //    }], "structuralTypes": [{ "shortName": "License", "namespace": "BusinessObjects", "autoGeneratedKeyType": "Identity", "defaultResourceName": "License", "dataProperties": [{ "name": "Id", "dataType": "Int16", "isNullable": false, "defaultValue": 0, "isPartOfKey": true, "validators": [{ "name": "required" }, { "name": "int16" }] }, { "name": "Name", "dataType": "String", "isNullable": false, "defaultValue": "", "maxLength": 50, "validators": [{ "name": "required" }, { "maxLength": 50, "name": "maxLength" }] }, { "name": "Description", "dataType": "String", "validators": [{ "name": "string" }] }, { "name": "Text", "dataType": "String", "isNullable": false, "defaultValue": "", "validators": [{ "name": "required" }, { "name": "string" }] }, { "name": "CreatedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "ModifiedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "DeletedOn", "dataType": "DateTime", "validators": [{ "name": "date" }] }], "navigationProperties": [{ "name": "OrganizationSet", "entityTypeName": "Organization:#BusinessObjects", "isScalar": false, "associationName": "FK_Organization_License", "invForeignKeyNames": ["LicenseId"] }, { "name": "UserLicenseRatingSet", "entityTypeName": "UserLicenseRating:#BusinessObjects", "isScalar": false, "associationName": "FK_UserLicenseRating_License", "invForeignKeyNames": ["LicenseId"] }] }, { "shortName": "Organization", "namespace": "BusinessObjects", "autoGeneratedKeyType": "Identity", "defaultResourceName": "Organization", "dataProperties": [{ "name": "Id", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "isPartOfKey": true, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "SectorId", "dataType": "Int16", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int16" }] }, { "name": "Name", "dataType": "String", "isNullable": false, "defaultValue": "", "maxLength": 100, "validators": [{ "name": "required" }, { "maxLength": 100, "name": "maxLength" }] }, { "name": "ProductionCost", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }] }, { "name": "SalesPrice", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }] }, { "name": "LicenseId", "dataType": "Int16", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int16" }] }, { "name": "CreatedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "ModifiedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "DeletedOn", "dataType": "DateTime", "validators": [{ "name": "date" }] }], "navigationProperties": [{ "name": "Sector", "entityTypeName": "Sector:#BusinessObjects", "isScalar": true, "associationName": "FK_Organization_Sector", "foreignKeyNames": ["SectorId"] }, { "name": "License", "entityTypeName": "License:#BusinessObjects", "isScalar": true, "associationName": "FK_Organization_License", "foreignKeyNames": ["LicenseId"] }, { "name": "ResourcePoolOrganizationSet", "entityTypeName": "ResourcePoolOrganization:#BusinessObjects", "isScalar": false, "associationName": "FK_ResourcePoolOrganization_Organization", "invForeignKeyNames": ["OrganizationId"] }] }, { "shortName": "Sector", "namespace": "BusinessObjects", "autoGeneratedKeyType": "Identity", "defaultResourceName": "Sector", "dataProperties": [{ "name": "Id", "dataType": "Int16", "isNullable": false, "defaultValue": 0, "isPartOfKey": true, "validators": [{ "name": "required" }, { "name": "int16" }] }, { "name": "Name", "dataType": "String", "isNullable": false, "defaultValue": "", "maxLength": 50, "validators": [{ "name": "required" }, { "maxLength": 50, "name": "maxLength" }] }, { "name": "Description", "dataType": "String", "validators": [{ "name": "string" }] }, { "name": "CreatedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "ModifiedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "DeletedOn", "dataType": "DateTime", "validators": [{ "name": "date" }] }], "navigationProperties": [{ "name": "OrganizationSet", "entityTypeName": "Organization:#BusinessObjects", "isScalar": false, "associationName": "FK_Organization_Sector", "invForeignKeyNames": ["SectorId"] }, { "name": "UserSectorRatingSet", "entityTypeName": "UserSectorRating:#BusinessObjects", "isScalar": false, "associationName": "FK_UserSectorRating_Sector", "invForeignKeyNames": ["SectorId"] }] }, {
            //        "shortName": "User", "namespace": "BusinessObjects", "autoGeneratedKeyType": "Identity", "defaultResourceName": "User", "dataProperties": [{ "name": "Id", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "isPartOfKey": true, "validators": [{ "name": "required" }, { "name": "int32" }] },
            //            {
            //                "name": "Email", "dataType": "String", "isNullable": false, "defaultValue": "", "maxLength": 100, "validators": [{ "name": "required" }, { "maxLength": 100, "name": "maxLength" }]
            //            }, { "name": "Password", "dataType": "String", "isNullable": false, "defaultValue": "", "maxLength": 50, "validators": [{ "name": "required" }, { "maxLength": 50, "name": "maxLength" }] }, { "name": "FirstName", "dataType": "String", "maxLength": 50, "validators": [{ "maxLength": 50, "name": "maxLength" }] }, { "name": "MiddleName", "dataType": "String", "maxLength": 50, "validators": [{ "maxLength": 50, "name": "maxLength" }] }, { "name": "LastName", "dataType": "String", "maxLength": 50, "validators": [{ "maxLength": 50, "name": "maxLength" }] }, { "name": "UserAccountTypeId", "dataType": "Byte", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "byte" }] }, { "name": "Notes", "dataType": "String", "validators": [{ "name": "string" }] }, { "name": "CreatedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "ModifiedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "DeletedOn", "dataType": "DateTime", "validators": [{ "name": "date" }] }], "navigationProperties": [{
            //            "name": "UserResourcePoolSet",
            //            "entityTypeName": "UserResourcePool:#BusinessObjects", "isScalar": false, "associationName": "FK_UserResourcePool_User", "invForeignKeyNames": ["UserId"]
            //        }, { "name": "UserLicenseRatingSet", "entityTypeName": "UserLicenseRating:#BusinessObjects", "isScalar": false, "associationName": "FK_UserLicenseRating_User", "invForeignKeyNames": ["UserId"] }, { "name": "UserSectorRatingSet", "entityTypeName": "UserSectorRating:#BusinessObjects", "isScalar": false, "associationName": "FK_UserSectorRating_User", "invForeignKeyNames": ["UserId"] }, { "name": "UserResourcePoolOrganizationSet", "entityTypeName": "UserResourcePoolOrganization:#BusinessObjects", "isScalar": false, "associationName": "FK_UserResourcePoolOrganization_User", "invForeignKeyNames": ["UserId"] }]
            //    }, { "shortName": "UserLicenseRating", "namespace": "BusinessObjects", "autoGeneratedKeyType": "Identity", "defaultResourceName": "UserLicenseRating", "dataProperties": [{ "name": "Id", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "isPartOfKey": true, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "UserId", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "LicenseId", "dataType": "Int16", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int16" }] }, { "name": "Rating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }] }, { "name": "CreatedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "ModifiedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "DeletedOn", "dataType": "DateTime", "validators": [{ "name": "date" }] }], "navigationProperties": [{ "name": "License", "entityTypeName": "License:#BusinessObjects", "isScalar": true, "associationName": "FK_UserLicenseRating_License", "foreignKeyNames": ["LicenseId"] }, { "name": "User", "entityTypeName": "User:#BusinessObjects", "isScalar": true, "associationName": "FK_UserLicenseRating_User", "foreignKeyNames": ["UserId"] }] }, { "shortName": "UserSectorRating", "namespace": "BusinessObjects", "autoGeneratedKeyType": "Identity", "defaultResourceName": "UserSectorRating", "dataProperties": [{ "name": "Id", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "isPartOfKey": true, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "UserId", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "SectorId", "dataType": "Int16", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int16" }] }, { "name": "Rating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }] }, { "name": "CreatedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "ModifiedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "DeletedOn", "dataType": "DateTime", "validators": [{ "name": "date" }] }], "navigationProperties": [{ "name": "Sector", "entityTypeName": "Sector:#BusinessObjects", "isScalar": true, "associationName": "FK_UserSectorRating_Sector", "foreignKeyNames": ["SectorId"] }, { "name": "User", "entityTypeName": "User:#BusinessObjects", "isScalar": true, "associationName": "FK_UserSectorRating_User", "foreignKeyNames": ["UserId"] }] }, {
            //        "shortName": "ResourcePool", "namespace": "BusinessObjects", "autoGeneratedKeyType": "Identity", "defaultResourceName": "ResourcePool", "dataProperties": [{ "name": "Id", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "isPartOfKey": true, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "Name", "dataType": "String", "isNullable": false, "defaultValue": "", "maxLength": 50, "validators": [{ "name": "required" }, { "maxLength": 50, "name": "maxLength" }] }, { "name": "CreatedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "ModifiedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "DeletedOn", "dataType": "DateTime", "validators": [{ "name": "date" }] }], "navigationProperties": [{ "name": "ResourcePoolOrganizationSet", "entityTypeName": "ResourcePoolOrganization:#BusinessObjects", "isScalar": false, "associationName": "FK_ResourcePoolOrganization_ResourcePool", "invForeignKeyNames": ["ResourcePoolId"] }, {
            //            "name": "UserResourcePoolSet",
            //            "entityTypeName": "UserResourcePool:#BusinessObjects", "isScalar": false, "associationName": "FK_UserResourcePool_ResourcePool", "invForeignKeyNames": ["ResourcePoolId"]
            //        }]
            //    }, { "shortName": "ResourcePoolOrganization", "namespace": "BusinessObjects", "autoGeneratedKeyType": "Identity", "defaultResourceName": "ResourcePoolOrganization", "dataProperties": [{ "name": "Id", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "isPartOfKey": true, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "ResourcePoolId", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "OrganizationId", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "CreatedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "ModifiedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "DeletedOn", "dataType": "DateTime", "validators": [{ "name": "date" }] }], "navigationProperties": [{ "name": "Organization", "entityTypeName": "Organization:#BusinessObjects", "isScalar": true, "associationName": "FK_ResourcePoolOrganization_Organization", "foreignKeyNames": ["OrganizationId"] }, { "name": "ResourcePool", "entityTypeName": "ResourcePool:#BusinessObjects", "isScalar": true, "associationName": "FK_ResourcePoolOrganization_ResourcePool", "foreignKeyNames": ["ResourcePoolId"] }, { "name": "UserResourcePoolOrganizationSet", "entityTypeName": "UserResourcePoolOrganization:#BusinessObjects", "isScalar": false, "associationName": "FK_UserResourcePoolOrganization_ResourcePoolOrganization", "invForeignKeyNames": ["ResourcePoolOrganizationId"] }] },
            //    {
            //        "shortName": "UserResourcePool",
            //        "namespace": "BusinessObjects", "autoGeneratedKeyType": "Identity", "defaultResourceName": "UserResourcePool",
            //        "dataProperties":
            //            [{
            //                "name": "Id", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "isPartOfKey": true, "validators": [{ "name": "required" }, { "name": "int32" }]
            //            }, {
            //                "name": "UserId", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int32" }]
            //            }, {
            //                "name": "ResourcePoolId", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int32" }]
            //            }, {
            //                "name": "ResourcePoolRate", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }]
            //            }, {
            //                "name": "TotalCostIndexRating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }]
            //            }, {
            //                "name": "KnowledgeIndexRating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }]
            //            }, {
            //                "name": "QualityIndexRating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }]
            //            }, {
            //                "name": "SectorIndexRating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }]
            //            }, {
            //                "name": "EmployeeSatisfactionIndexRating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }]
            //            }, {
            //                "name": "CustomerSatisfactionIndexRating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }]
            //            }, {
            //                "name": "DistanceIndexRating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }]
            //            }, {
            //                "name": "CreatedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }]
            //            }, {
            //                "name": "ModifiedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }]
            //            }, {
            //                "name": "DeletedOn", "dataType": "DateTime", "validators": [{ "name": "date" }]
            //            }, {
            //                "name": "TestValue", "dataType": "String", "isNullable": false, "defaultValue": "", "maxLength": 100, "validators": [{ "name": "required" }, { "maxLength": 100, "name": "maxLength" }]
            //            }],
            //        "navigationProperties": [{
            //            "name": "User", "entityTypeName": "User:#BusinessObjects", "isScalar": true, "associationName": "FK_UserResourcePool_User", "foreignKeyNames": ["UserId"]
            //        }, {
            //            "name": "ResourcePool", "entityTypeName": "ResourcePool:#BusinessObjects", "isScalar": true, "associationName": "FK_UserResourcePool_ResourcePool", "foreignKeyNames": ["ResourcePoolId"]
            //        }]
            //    }, { "shortName": "UserResourcePoolOrganization", "namespace": "BusinessObjects", "autoGeneratedKeyType": "Identity", "defaultResourceName": "UserResourcePoolOrganization", "dataProperties": [{ "name": "Id", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "isPartOfKey": true, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "UserId", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "ResourcePoolOrganizationId", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "NumberOfSales", "dataType": "Int32", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "int32" }] }, { "name": "QualityRating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }] }, { "name": "CustomerSatisfactionRating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }] }, { "name": "EmployeeSatisfactionRating", "dataType": "Decimal", "isNullable": false, "defaultValue": 0, "validators": [{ "name": "required" }, { "name": "number" }] }, { "name": "CreatedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "ModifiedOn", "dataType": "DateTime", "isNullable": false, "defaultValue": "1899-12-31T22:00:00.000Z", "validators": [{ "name": "required" }, { "name": "date" }] }, { "name": "DeletedOn", "dataType": "DateTime", "validators": [{ "name": "date" }] }], "navigationProperties": [{ "name": "User", "entityTypeName": "User:#BusinessObjects", "isScalar": true, "associationName": "FK_UserResourcePoolOrganization_User", "foreignKeyNames": ["UserId"] }, { "name": "ResourcePoolOrganization", "entityTypeName": "ResourcePoolOrganization:#BusinessObjects", "isScalar": true, "associationName": "FK_UserResourcePoolOrganization_ResourcePoolOrganization", "foreignKeyNames": ["ResourcePoolOrganizationId"] }] }], "resourceEntityTypeMap": {
            //        "License": "License:#BusinessObjects", "Organization": "Organization:#BusinessObjects", "Sector": "Sector:#BusinessObjects", "User": "User:#BusinessObjects", "UserLicenseRating": "UserLicenseRating:#BusinessObjects", "UserSectorRating": "UserSectorRating:#BusinessObjects", "ResourcePool": "ResourcePool:#BusinessObjects", "ResourcePoolOrganization":
            //            "ResourcePoolOrganization:#BusinessObjects",
            //        "UserResourcePool": "UserResourcePool:#BusinessObjects",
            //        "UserResourcePoolOrganization": "UserResourcePoolOrganization:#BusinessObjects"
            //    }
            //};

            // mgr.metadataStore.importMetadata(metadata);

            return mgr;
        }
    }
})();